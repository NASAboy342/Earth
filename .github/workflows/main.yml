# Save this as C:\deploy\webhook-server.ps1

Add-Type -AssemblyName System.Net.HttpListener
$listener = New-Object System.Net.HttpListener
$listener.Prefixes.Add("https://localhost:1000/") # match your apini.ppiinn.net mapping
$listener.Start()
Write-Host "Webhook listener running on http://localhost:1000/"

while ($true) {
    $context = $listener.GetContext()
    $request = $context.Request
    $response = $context.Response

    # Optional: only allow POST
    if ($request.HttpMethod -eq "POST") {
        Write-Host "ðŸš€ Webhook received at $(Get-Date)"

        # Run your deployment script
        & "C:\deploy\test.ps1"

        $buffer = [System.Text.Encoding]::UTF8.GetBytes("Webhook executed successfully")
        $response.ContentLength64 = $buffer.Length
        $response.OutputStream.Write($buffer, 0, $buffer.Length)
    }

    $response.Close()
}
