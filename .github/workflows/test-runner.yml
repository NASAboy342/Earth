name: Test Self-Hosted Runner

on:
  push:
    branches: [ main ]

jobs:
  test-runner:
    runs-on: self-hosted  # This will use your self-hosted runner
    
    steps:
    - name: 🏃‍♂️ Test Runner Connection
      shell: pwsh
      run: |
        Write-Host "🎉 Self-hosted runner is working!"
        Write-Host "🖥️  Runner OS: $($env:OS)"
        Write-Host "🏗️  Runner Architecture: $($env:PROCESSOR_ARCHITECTURE)"
        Write-Host "📅 Current Date: $(Get-Date)"
        Write-Host "📁 Current Directory: $(Get-Location)"
        Write-Host "👤 Current User: $($env:USERNAME)"
        
    - name: 🔍 Check Available Tools
      shell: pwsh
      run: |
        Write-Host "🛠️  Checking available tools..."
        try { Write-Host "Git version: $(git --version)" } catch { Write-Host "Git not found" }
        try { Write-Host "Node version: $(node --version)" } catch { Write-Host "Node not found" }
        try { Write-Host "NPM version: $(npm --version)" } catch { Write-Host "NPM not found" }
        Write-Host "PowerShell version: $($PSVersionTable.PSVersion)"
        
    - name: 🧪 Test Basic Commands
      shell: pwsh
      run: |
        Write-Host "🧪 Running basic command tests..."
        Write-Host "📊 System uptime:"
        try { Write-Host "$(Get-CimInstance -ClassName Win32_OperatingSystem | Select-Object @{Name='Uptime'; Expression={(Get-Date) - $_.LastBootUpTime}})" } catch { Write-Host "Uptime check failed" }
        Write-Host "💾 Disk space:"
        try { Get-CimInstance -ClassName Win32_LogicalDisk | Where-Object {$_.DriveType -eq 3} | Select-Object DeviceID, @{Name='Size(GB)'; Expression={[math]::Round($_.Size/1GB,2)}}, @{Name='FreeSpace(GB)'; Expression={[math]::Round($_.FreeSpace/1GB,2)}} } catch { Write-Host "Disk space check failed" }
        Write-Host "🔍 Environment variables (filtered):"
        try { Get-ChildItem env: | Where-Object {$_.Name -match "^(PATH|HOME|USER|RUNNER|COMPUTERNAME)"} | Select-Object -First 10 | Format-Table Name, Value } catch { Write-Host "Environment check failed" }
        
    - name: ✅ Test Complete
      shell: pwsh
      run: |
        Write-Host "🎊 All tests completed successfully!"
        Write-Host "✨ Your self-hosted runner is ready to use!"
